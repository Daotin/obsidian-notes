> **ä½œè€…ï¼šå­™å‰‘é”‹**
>
> æœ¬äººåšäº†éƒ¨åˆ† UI ä¿®æ”¹å’Œå°‘é‡æ–‡æ¡ˆä¿®æ”¹ã€‚

æ­å»ºè„šæ‰‹æ¶çš„ç›®çš„æ˜¯**å¿«é€Ÿçš„æ­å»ºé¡¹ç›®çš„åŸºæœ¬ç»“æ„å¹¶æä¾›é¡¹ç›®è§„èŒƒå’Œçº¦å®š**ã€‚æ¯”å¦‚æˆ‘ä»¬å¸¸ç”¨çš„ vue-cliã€create-react-appã€angular-cli ç­‰ç­‰ï¼Œéƒ½æ˜¯é€šè¿‡ç®€å•çš„åˆå§‹åŒ–å‘½ä»¤ï¼Œå®Œæˆå†…å®¹çš„å¿«é€Ÿæ„å»ºã€‚è„šæ‰‹æ¶æ˜¯æˆ‘ä»¬å¸¸ç”¨çš„å·¥å…·ï¼Œä¹Ÿæ˜¯å›¢é˜Ÿææ•ˆçš„é‡è¦æ‰‹æ®µã€‚

## ä¸€ã€è„šæ‰‹æ¶çš„ç®€å•é›å½¢

> **è„šæ‰‹æ¶åœ¨å¯åŠ¨çš„æ—¶å€™è¯¢é—®ä¸€äº›ç®€å•çš„é—®é¢˜ï¼Œå¹¶ä¸”é€šè¿‡ç”¨æˆ·å›ç­”çš„ç»“æœå»æ¸²æŸ“å¯¹åº”çš„æ¨¡ç‰ˆæ–‡ä»¶**ã€‚
>
> åŸºæœ¬å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š
>
> 1. é€šè¿‡å‘½ä»¤è¡Œäº¤äº’è¯¢é—®ç”¨æˆ·é—®é¢˜
> 2. æ ¹æ®ç”¨æˆ·å›ç­”çš„ç»“æœç”Ÿæˆæ–‡ä»¶

æ¯”å¦‚æˆ‘ä»¬åœ¨ä½¿ç”¨[vite](https://cn.vitejs.dev/guide/#scaffolding-your-first-vite-project)åˆ›å»ºä¸€ä¸ª vue é¡¹ç›®çš„æ—¶å€™

#### step1ï¼šè¿è¡Œåˆ›å»ºå‘½ä»¤

```js
npm create vite@latest
```

#### step2ï¼šè¯¢é—®ç”¨æˆ·é—®é¢˜

![](images/2023-07-11-10-13-48.png)

![](images/2023-07-11-10-16-36.png)

#### step3ï¼šç”Ÿæˆç¬¦åˆç”¨æˆ·éœ€æ±‚çš„é¡¹ç›®æ–‡ä»¶

![](images/2023-07-11-10-17-35.png)

å‚è€ƒä»¥ä¸Šçš„æµç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå·±æ¥æ­å»ºä¸€ä¸ªç®€å•çš„è„šæ‰‹æ¶ã€‚

## äºŒã€æ­å»ºä¸€ä¸ªç®€å•çš„è„šæ‰‹æ¶é›å½¢

### 1.åœ¨å‘½ä»¤è¡Œå¯åŠ¨ cli

ç›®æ ‡ï¼šå®ç°åœ¨å‘½ä»¤è¡Œæ‰§è¡Œ`demo-cli`æ¥å¯åŠ¨æˆ‘ä»¬çš„è„šæ‰‹æ¶ã€‚

#### 1.1 æ–°å»ºé¡¹ç›®ç›®å½• demo-cli

```js
mkdir demo-cli
cd demo-cli
//ç”Ÿæˆpackage.json
npm init
```

#### 1.2 æ–°å»ºç¨‹åºå…¥å£æ–‡ä»¶ index.js

åœ¨ package.json æ–‡ä»¶ä¸­æŒ‡å®šå…¥å£æ–‡ä»¶ä¸º index.jsï¼Œå¦‚ä¸‹

```json
{
  "name": "demo-cli",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "bin": "index.js", // æ‰‹åŠ¨æ·»åŠ å…¥å£æ–‡ä»¶ä¸ºindex.js
  "type": "module", // æ³¨æ„ï¼Œæ­¤å¤„è®¾ç½®ä¹‹åï¼Œé¡¹ç›®ä¸­ä¾èµ–çš„å¼•å…¥æ–¹å¼å¿…é¡»éµå¾ªESMè§„èŒƒã€‚
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "author": "",
  "license": "ISC"
}
```

:::details â“ åœ¨ package.json ä¸­ï¼Œmain å’Œ bin çš„ä½œç”¨å’ŒåŒºåˆ«åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ

åœ¨ package.json æ–‡ä»¶ä¸­ï¼Œ"main"å’Œ"bin"æ˜¯ä¸¤ä¸ªé‡è¦çš„å±æ€§ã€‚

"main"å±æ€§æŒ‡å®šäº†è¯¥æ¨¡å—çš„å…¥å£æ–‡ä»¶ï¼Œåœ¨ä½¿ç”¨ require()å‡½æ•°å¯¼å…¥æ¨¡å—æ—¶ä¼šé»˜è®¤åŠ è½½è¯¥æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼š

```
{
  "name": "my-module",
  "version": "1.0.0",
  "main": "index.js"
}
```

ä¸Šé¢çš„ç¤ºä¾‹æŒ‡å®šäº†å…¥å£æ–‡ä»¶ä¸º index.jsï¼Œå› æ­¤å½“å…¶ä»–æ¨¡å—ä½¿ç”¨ require("my-module")åŠ è½½è¯¥æ¨¡å—æ—¶ï¼ŒNode.js ä¼šè‡ªåŠ¨åŠ è½½ index.js æ–‡ä»¶ã€‚

"bin"å±æ€§åˆ™ç”¨äºå®šä¹‰å‘½ä»¤è¡Œå·¥å…·çš„å…¥å£æ–‡ä»¶ï¼Œå¯ä»¥å°†è¯¥å·¥å…·å®‰è£…åˆ°å…¨å±€ç¯å¢ƒä¸­ï¼Œä»è€Œå¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­ç›´æ¥ä½¿ç”¨è¯¥å·¥å…·ã€‚ä¾‹å¦‚ï¼š

```
{
  "name": "my-cli-tool",
  "version": "1.0.0",
  "bin": {
    "my-tool": "./bin/my-tool.js"
  }
}
```

ä¸Šé¢çš„ç¤ºä¾‹å®šä¹‰äº†ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·"my-tool"ï¼Œå¹¶å°†å…¶å…¥å£æ–‡ä»¶æŒ‡å®šä¸º"./bin/my-tool.js"ã€‚å½“ç”¨æˆ·åœ¨å‘½ä»¤è¡Œä¸­æ‰§è¡Œ"my-tool"å‘½ä»¤æ—¶ï¼ŒNode.js ä¼šè‡ªåŠ¨åŠ è½½è¯¥æ–‡ä»¶å¹¶æ‰§è¡Œå…¶ä¸­çš„ä»£ç ã€‚

å› æ­¤ï¼Œ"main"å±æ€§ç”¨äºæŒ‡å®šæ¨¡å—çš„å…¥å£æ–‡ä»¶ï¼Œè€Œ"bin"å±æ€§ç”¨äºæŒ‡å®šå‘½ä»¤è¡Œå·¥å…·çš„å…¥å£æ–‡ä»¶ã€‚ä¸¤è€…çš„ä½œç”¨å’Œä½¿ç”¨åœºæ™¯ä¸åŒï¼Œä½†éƒ½æ˜¯ package.json æ–‡ä»¶ä¸­éå¸¸å¸¸ç”¨çš„å±æ€§ã€‚

:::

æ­¤æ—¶ï¼Œé¡¹ç›®ç›®å½•ç»“æ„

```
demo-cli
â”œâ”€ index.js
â””â”€ package.json
```

æ‰“å¼€ index.js è¿›è¡Œç¼–è¾‘

```js
#! /usr/bin/env node

// #! æ˜¯ç”¨äºæŒ‡å®šè„šæœ¬çš„è§£é‡Šç¨‹åº
// Node CLI åº”ç”¨å…¥å£æ–‡ä»¶å¿…é¡»è¦æœ‰è¿™æ ·çš„æ–‡ä»¶å¤´
console.log("hello world");
```

#### 1.3 npm link é“¾æ¥åˆ°å…¨å±€

åº“åŒ…åœ¨å¼€å‘æˆ–è¿­ä»£åï¼Œä¸é€‚åˆå‘å¸ƒåˆ°çº¿ä¸Šè¿›è¡Œè°ƒè¯•ï¼ˆè¿‡ç¨‹ç¹çä¸”ä¼šå¯¼è‡´ç‰ˆæœ¬å·è†¨èƒ€ï¼‰ã€‚`npm link`å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ¨¡æ‹ŸåŒ…å®‰è£…åçš„çŠ¶æ€ï¼Œå®ƒä¼šåœ¨ç³»ç»Ÿä¸­åšä¸€ä¸ªå¿«æ·æ–¹å¼æ˜ å°„ï¼Œè®©æœ¬åœ°çš„åŒ…å°±å¥½åƒ install è¿‡ä¸€æ ·ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚å¯ä»¥ç”¨`npm unlink`è§£é™¤é“¾æ¥ã€‚

```
npm link
```

æ‰§è¡Œå®Œæˆ

![](images/2023-07-11-10-19-35.png)

ç°åœ¨å¯ä»¥æ¥æµ‹è¯•ä¸€ä¸‹ï¼Œåœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥ demo-cli æ‰§è¡Œä¸€ä¸‹

```
demo-cli
```

å°±å¯ä»¥çœ‹åˆ°å‘½ä»¤è¡Œä¸­æ‰“å°çš„å†…å®¹äº†

![](images/2023-07-11-10-20-38.png)

### 2.è¯¢é—®ç”¨æˆ·ä¿¡æ¯

å®ç°è¯¢é—®ç”¨æˆ·ä¿¡æ¯çš„åŠŸèƒ½éœ€è¦å¼•å…¥[inquirer](https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FSBoudrias%2FInquirer.js%2F)

```js
npm install inquirer
// or
yarn add inquirer
```

ç„¶ååœ¨ index.js ä¸­è®¾ç½®æˆ‘ä»¬çš„é—®é¢˜

```js
#! /usr/bin/env node

import inquirer from "inquirer";

inquirer
  .prompt([
    {
      type: "input",
      name: "name", // key
      message: "ä½ çš„åå­—", // æç¤ºä¿¡æ¯
      default: "demo-cli", // é»˜è®¤å€¼
    },
  ])
  .then((answer) => {
    console.log(answer);
  });
```

åœ¨å‘½ä»¤è¡Œè¾“å…¥ demo-cliï¼Œçœ‹ä¸‹æ‰§è¡Œç»“æœ

![](images/2023-07-11-10-20-54.png)

### 3.ç”Ÿæˆå¯¹åº”æ–‡ä»¶

#### 3.1 æ–°å»ºæ¨¡ç‰ˆæ–‡ä»¶å¤¹

```js
mkdir templates
```

#### 3.2 æ–°å»º index.html å’Œ base.css ä¸¤ä¸ªå®ä¾‹æ–‡ä»¶

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title><!-- ejsè¯­æ³• --> <%= name %></title>
  </head>
  <body>
    <h1><%= name %></h1>
  </body>
</html>
```

```css
body {
  margin: 20px auto;
  background-color: #000;
}
```

æ­¤æ—¶çš„ç›®å½•ç»“æ„

```json
demo-cli
â”œâ”€ templates
â”‚  â”œâ”€ base.css
â”‚  â””â”€ index.html
â”œâ”€ index.js
â”œâ”€ package-lock.json
â””â”€ package.json
```

#### 3.3 å®Œå–„æ–‡ä»¶ç”Ÿæˆé€»è¾‘

è¿™é‡Œå€ŸåŠ© ejs æ¨¡ç‰ˆå¼•æ“å°†ç”¨æˆ·è¾“å…¥çš„ä¿¡æ¯æ¸²æŸ“åˆ°æ¨¡ç‰ˆä¸Š

```js
npm install ejs --dev
// or
yarn add -D ejs
```

å®Œå–„ index.js

```js
#! /usr/bin/env node

import inquirer from "inquirer";
import path from "path";
import fs from "fs";
import ejs from "ejs";

// åœ¨æœ€æ–°çš„ESModuleä¸­ï¼Œæ²¡æœ‰å…¨å±€å˜é‡ __dirnameï¼Œæ‰€ä»¥éœ€è¦è‡ªå·±å®šä¹‰å˜é‡æ‰èƒ½ä½¿ç”¨
import { fileURLToPath } from "node:url";
import { dirname } from "node:path";
const __dirname = dirname(fileURLToPath(import.meta.url));

inquirer
  .prompt([
    {
      type: "input",
      name: "name", // key
      message: "ä½ çš„åå­—", // æç¤ºä¿¡æ¯
      default: "demo-cli", // é»˜è®¤å€¼
    },
  ])
  .then((answer) => {
    // æ¨¡ç‰ˆæ–‡ä»¶ç›®å½•
    const destUrl = path.join(__dirname, "templates");
    // ç”Ÿæˆæ–‡ä»¶ç›®å½•
    const cwdUrl = process.cwd();
    // ä»æ¨¡ç‰ˆç›®å½•ä¸­è¯»å–æ–‡ä»¶
    fs.readdir(destUrl, (err, files) => {
      if (err) throw err;
      files.forEach((file) => {
        // ä½¿ç”¨ejsæ¸²æŸ“å¯¹åº”çš„æ¨¡ç‰ˆæ–‡ä»¶
        ejs.renderFile(path.join(destUrl, file), answer).then((data) => {
          // ç”Ÿæˆejså¤„ç†åçš„æ¨¡ç‰ˆæ–‡ä»¶
          fs.writeFileSync(path.join(cwdUrl, file), data);
        });
      });
    });
  });
```

:::details â“ ä»£ç è¯¦ç»†è§£é‡Š

è¿™æ®µä»£ç æ˜¯ä¸€ä¸ªç®€å•çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œå®ƒä½¿ç”¨ Node.js ç¼–å†™ï¼Œå¹¶åˆ©ç”¨äº† `inquirer` å’Œ `ejs` è¿™ä¸¤ä¸ªåº“ã€‚å®ƒçš„ä¸»è¦åŠŸèƒ½æ˜¯è·å¾—ç”¨æˆ·è¾“å…¥çš„åå­—ï¼Œç„¶åæ ¹æ®æ¨¡æ¿æ–‡ä»¶ç”Ÿæˆç›¸åº”çš„æ–‡ä»¶ã€‚ä¸‹é¢æˆ‘ä¼šè¯¦ç»†è§£é‡Šæ¯ä¸€éƒ¨åˆ†çš„åŠŸèƒ½ã€‚

1. `#! /usr/bin/env node` è¿™ä¸€è¡Œæ˜¯ä¸€ä¸ª [shebang â†—](<https://en.wikipedia.org/wiki/Shebang_(Unix)>) ï¼Œå®ƒå‘Šè¯‰æ“ä½œç³»ç»Ÿè¿™ä¸ªæ–‡ä»¶æ˜¯ä¸€ä¸ª Node.js è„šæœ¬ã€‚

2. å¯¼å…¥æ‰€éœ€çš„ä¾èµ–åº“ã€‚

   - `inquirer` ç”¨äºè·å–å‘½ä»¤è¡Œç”¨æˆ·è¾“å…¥ã€‚
   - `path` æ˜¯ Node.js çš„å†…ç½®åº“ï¼Œç”¨äºå¤„ç†æ–‡ä»¶å’Œç›®å½•è·¯å¾„ã€‚
   - `fs` ä¹Ÿæ˜¯ Node.js çš„å†…ç½®åº“ï¼Œç”¨äºæ–‡ä»¶ç³»ç»Ÿæ“ä½œã€‚
   - `ejs` æ˜¯ä¸€ä¸ªè½»é‡çº§çš„æ¨¡æ¿å¼•æ“ï¼Œç”¨äºæ ¹æ®æ¨¡æ¿ç”Ÿæˆæ–‡ä»¶ã€‚

3. åœ¨ ESModule ä¸­ï¼Œå…¨å±€å˜é‡ `__dirname` æœªå®šä¹‰ã€‚å› æ­¤ï¼Œéœ€è¦å¯¼å…¥ `fileURLToPath` å’Œ `dirname` å‡½æ•°æ¥åˆ›å»º `__dirname` å˜é‡ï¼Œè¡¨ç¤ºå½“å‰æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ã€‚

4. ä½¿ç”¨ `inquirer.prompt` å‡½æ•°å‘ç”¨æˆ·æ˜¾ç¤ºä¸€ä¸ªé—®é¢˜ï¼Œè¦æ±‚ç”¨æˆ·è¾“å…¥åå­—ã€‚è¿™ä¸ªå‡½æ•°è¿”å›ä¸€ä¸ª Promiseï¼Œå½“ç”¨æˆ·è¾“å…¥å®Œæˆåï¼Œä¼šå°†ç”¨æˆ·çš„è¾“å…¥ä½œä¸ºå‚æ•°ä¼ é€’ç»™ `.then()` æ–¹æ³•ã€‚

5. åœ¨ `.then()` æ–¹æ³•å†…éƒ¨ï¼Œé¦–å…ˆå®šä¹‰æ¨¡æ¿æ–‡ä»¶ç›®å½• `destUrl` å’Œç”Ÿæˆæ–‡ä»¶ç›®å½• `cwdUrl`ã€‚

6. ä½¿ç”¨ `fs.readdir()` å‡½æ•°è¯»å–æ¨¡æ¿æ–‡ä»¶ç›®å½•ï¼Œç„¶åéå†å…¶ä¸­çš„æ¯ä¸ªæ–‡ä»¶ã€‚å¯¹äºæ¯ä¸ªæ–‡ä»¶ï¼š

   - ä½¿ç”¨ `ejs.renderFile()` å‡½æ•°æ ¹æ®ç”¨æˆ·è¾“å…¥çš„åå­—æ¸²æŸ“æ¨¡æ¿æ–‡ä»¶ã€‚
   - åœ¨æ¸²æŸ“å®Œæˆåï¼Œå°†ç”Ÿæˆçš„æ–‡ä»¶ä¿å­˜åˆ°ç”Ÿæˆæ–‡ä»¶ç›®å½•ä¸­ã€‚

è¿™æ ·ï¼Œå½“è¿è¡Œè¿™ä¸ªè„šæœ¬æ—¶ï¼Œç”¨æˆ·ä¼šè¢«æç¤ºè¾“å…¥åå­—ï¼Œç„¶åç¨‹åºä¼šæ ¹æ®æ¨¡æ¿æ–‡ä»¶ç”Ÿæˆç›¸åº”çš„æ–‡ä»¶ã€‚
:::

åœ¨å‘½ä»¤è¡Œæ‰§è¡Œä¸€ä¸‹ demo-cliï¼Œæ­¤æ—¶ index.htmlã€base.css å·²ç»æˆåŠŸåˆ›å»º

```json
demo-cli
â”œâ”€ templates
â”‚  â”œâ”€ base.css
â”‚  â””â”€ index.html
â”œâ”€ base.css        // ç”Ÿæˆçš„å¯¹åº”çš„base.cssæ–‡ä»¶
â”œâ”€ index.html  		 //	ç”Ÿæˆçš„å¯¹åº”çš„index.htmlæ–‡ä»¶
â”œâ”€ index.js
â”œâ”€ package-lock.json
â””â”€ package.json
```

æ‰“å¼€ç”Ÿæˆ index.html æ–‡ä»¶

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title><!-- ejsè¯­æ³• --> demo-cli</title>
  </head>
  <body>
    <h1>demo-cli</h1>
  </body>
</html>
```

å¯ä»¥çœ‹åˆ°ç”¨æˆ·è¾“å…¥çš„ `{ name: 'demo-cli' }` å·²ç»æ·»åŠ åˆ°ç”Ÿæˆçš„ html æ–‡ä»¶ä¸­äº†ã€‚

## ä¸‰ã€å¸¸ç”¨è„šæ‰‹æ¶å·¥å…·åº“

å®é™…ç”Ÿäº§ä¸­æ­å»ºä¸€ä¸ªè„šæ‰‹æ¶æˆ–è€…æˆ‘ä»¬åœ¨é˜…è¯»å…¶ä»–è„šæ‰‹æ¶æºç çš„æ—¶å€™éœ€è¦äº†è§£ä¸‹é¢è¿™äº›å·¥å…·åº“

| åç§°                                                                                                                      | ç®€ä»‹                                                             |
| ------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------- |
| [commander](https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Ftj%2Fcommander.js%2Fblob%2Fmaster%2FReadme_zh-CN.md) | å‘½ä»¤è¡Œè‡ªå®šä¹‰æŒ‡ä»¤                                                 |
| [inquirer](https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FSBoudrias%2FInquirer.js%2F)                           | å‘½ä»¤è¡Œè¯¢é—®ç”¨æˆ·é—®é¢˜ï¼Œè®°å½•å›ç­”ç»“æœ                                 |
| [chalk](https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fchalk)                                      | æ§åˆ¶å°è¾“å‡ºå†…å®¹æ ·å¼ç¾åŒ–                                           |
| [ora](https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fora)                                          | æ§åˆ¶å° loading æ ·å¼                                              |
| [figlet](https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Ffiglet)                                    | æ§åˆ¶å°æ‰“å° logo                                                  |
| [easy-table](https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Feasy-table)                            | æ§åˆ¶å°è¾“å‡ºè¡¨æ ¼                                                   |
| [download-git-repo](https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fdownload-git-repo)              | ä¸‹è½½è¿œç¨‹æ¨¡ç‰ˆ                                                     |
| [fs-extra](https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Ffs-extra)                                | ç³»ç»Ÿ fs æ¨¡å—çš„æ‰©å±•ï¼Œæä¾›äº†æ›´å¤šä¾¿åˆ©çš„ APIï¼Œå¹¶ç»§æ‰¿äº† fs æ¨¡å—çš„ API |
| [cross-spawn](https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fcross-spawn)                          | æ”¯æŒè·¨å¹³å°è°ƒç”¨ç³»ç»Ÿä¸Šçš„å‘½ä»¤                                       |

åœ¨è¿™é‡Œä¸»è¦ä»‹ç»ä¸‹é¢è¿™äº›ï¼Œå…¶ä»–çš„å·¥å…·å¯ä»¥æŸ¥çœ‹ç›¸å…³çš„è¯´æ˜æ–‡æ¡£

### 1.commander è‡ªå®šä¹‰å‘½ä»¤è¡ŒæŒ‡ä»¤

ç®€å•æ¡ˆä¾‹

#### 1.1 æ–°å»ºä¸€ä¸ªç®€å•çš„ Node Cli é¡¹ç›®

psï¼šå…·ä½“æµç¨‹å‚ç…§ä¸Šä¸€ç« èŠ‚

```json
{
  "name": "command-cli",
  "version": "1.0.0",
  "description": "",
  "main": "./bin/index.js",
  "bin": "bin/index.js",
  "type": "module", // æ³¨æ„ï¼Œæ­¤å¤„è®¾ç½®ä¹‹åï¼Œé¡¹ç›®ä¸­ä¾èµ–çš„å¼•å…¥æ–¹å¼å¿…é¡»éµå¾ªESMè§„èŒƒã€‚
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "author": "",
  "license": "ISC",
  "dependencies": {
    "commander": "^9.4.1"
  }
}
```

```json
command-cli
â”œâ”€ bin
â”‚  â””â”€ index.js
â”œâ”€ package-lock.json
â””â”€ package.json
```

#### 1.2 å¼•å…¥ commander

```js
npm install commander
// or
yarn add commander
```

å®Œå–„ index.js ä»£ç 

```js
#! /usr/bin/env node

import { program } from "commander";

program
  .version("1.0.0")
  .command("create <name>")
  .description("åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®")
  .action((name) => {
    // æ‰“å°å‘½ä»¤è¡Œè¾“å…¥çš„é¡¹ç›®åç§°
    console.log("é¡¹ç›®åç§°æ˜¯ï¼š" + name);
  });

program.parse();
```

#### 1.3npm link é“¾æ¥åˆ°å…¨å±€

- æ‰§è¡Œ `npm link`å°†åº”ç”¨é“¾æ¥åˆ°å…¨å±€
- å®Œæˆä¹‹åï¼Œåœ¨å‘½ä»¤è¡Œä¸­æ‰§è¡Œ`command-cli`

å¯ä»¥çœ‹åˆ°å‘½ä»¤è¡Œä¸­è¾“å‡ºçš„å†…å®¹<br />

![](images/2023-07-11-10-21-27.png)

æ­¤æ—¶å°±æœ‰äº†`command-cli`å‘½ä»¤ä½¿ç”¨çš„è¯´æ˜ä¿¡æ¯ï¼Œåœ¨å‘½ä»¤è¡Œä¸­æ‰§è¡Œä¸€ä¸‹<br />

![](images/2023-07-11-10-21-43.png)

è¿™ä¸ªæ—¶å€™æ§åˆ¶å°å°±æ‰“å°å‡ºæ¥ create å‘½ä»¤åé¢`<name>`çš„å€¼`demo`

### 2.chalk å‘½ä»¤è¡Œç¾åŒ–å·¥å…·

[chalk](https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fchalk)å¯ä»¥ç¾åŒ–æˆ‘ä»¬åœ¨å‘½ä»¤è¡Œä¸­è¾“å‡ºå†…å®¹çš„æ ·å¼ï¼Œä¾‹å¦‚å¯¹é‡ç‚¹ä¿¡æ¯æ·»åŠ é¢œè‰²<br />æˆ‘ä»¬åœ¨ command-cli é¡¹ç›®ä¸­è¿›è¡Œå®Œå–„ã€‚

#### 2.1 å®‰è£… chalk

```js
npm install chalk
// or
yarn add chalk
```

#### 2.2 åŸºæœ¬ä½¿ç”¨

æ‰“å¼€`bin/index.js`ï¼Œå¹¶å®Œå–„ä»£ç 

```js
#! /usr/bin/env node

import { program } from "commander";
import chalk from "chalk";

program
  .version("1.0.0")
  .command("create <name>")
  .description("åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®")
  .action((name) => {
    // æ‰“å°å‘½ä»¤è¡Œè¾“å…¥çš„é¡¹ç›®åç§°

    // æ–‡æœ¬æ ·å¼
    console.log("é¡¹ç›®åç§°æ˜¯ï¼š" + chalk.bold(name));

    // é¢œè‰²
    console.log("é¡¹ç›®åç§°æ˜¯ï¼š" + chalk.cyan(name));
    console.log("é¡¹ç›®åç§°æ˜¯ï¼š" + chalk.green(name));

    // èƒŒæ™¯è‰²
    console.log("é¡¹ç›®åç§°æ˜¯ï¼š" + chalk.bgRed(name));

    // ä½¿ç”¨RGBé¢œè‰²è¾“å‡º
    console.log("é¡¹ç›®åç§°æ˜¯ï¼š" + chalk.rgb(4, 156, 219).underline(name));
    console.log("é¡¹ç›®åç§°æ˜¯ï¼š" + chalk.hex("#049CDB").bold(name));
    console.log("é¡¹ç›®åç§°æ˜¯ï¼š" + chalk.bgHex("#049CDB").bold(name));
  });

program.parse();
```

åœ¨å‘½ä»¤è¡Œä¸­æ‰§è¡Œ`command-cli create demo`ï¼ŒæŸ¥çœ‹æ‰“å°å†…å®¹

![](images/2023-07-11-10-22-16.png)

æ›´å¤šæ ·å¼å¯ä»¥æŸ¥çœ‹[chalk](https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fchalk)æ–‡æ¡£

### 3.inquirer å‘½ä»¤è¡Œäº¤äº’å·¥å…·

[inquirer](https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FSBoudrias%2FInquirer.js%2F)å·¥å…·çš„åŸºæœ¬ä½¿ç”¨å·²åœ¨**è„šæ‰‹æ¶çš„ç®€å•é›å½¢**ä¸­ä½¿ç”¨åˆ°äº†ï¼Œåœ¨è¿™é‡Œä¸å†è¿‡è¿‡å¤šä»‹ç»ï¼Œæ›´å¤šç”¨æ³•å¯ä»¥æŸ¥çœ‹[inquirer](https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2FSBoudrias%2FInquirer.js%2F)æ–‡æ¡£ã€‚

### 4.ora å‘½ä»¤è¡Œ loading åŠ¨æ•ˆ

#### 4.1 å®‰è£… ora

```js
npm install ora
// or
yarn add ora
```

#### 4.2 åŸºæœ¬ä½¿ç”¨

```js
import ora from "ora";

const message = "Loading...";
const spinner = ora(message);
spinner.start();

setTimeout(() => {
  spinner.color = "red";
  spinner.text = "Loading Templates...";

  setTimeout(() => {
    // åŠ è½½çŠ¶æ€ä¿®æ”¹
    spinner.stop(); // åœæ­¢
    spinner.succeed("Loading succeed"); // æˆåŠŸ âœ”
    // spinner.fail(text?);  å¤±è´¥ âœ–
    // spinner.warn(text?);  æç¤º âš 
    // spinner.info(text?);  ä¿¡æ¯ â„¹
  }, 2000);
}, 2000);
```

åœ¨å‘½ä»¤è¡Œä¸­æ‰§è¡Œ`command-cli create demo`ï¼ŒæŸ¥çœ‹æ‰§è¡Œç»“æœ<br />

![](images/2023-07-11-10-24-40.png)

![](images/2023-07-11-10-24-50.png)

### 5.cross-spawn è·¨å¹³å° shell å·¥å…·

#### 5.1 å®‰è£… cross-spawn

```js
npm install cross-spawn
// or
yarn add cross-spawn
```

#### 5.2 åŸºæœ¬ä½¿ç”¨

```js
import spawn from "cross-spawn";

// å®šä¹‰éœ€è¦éœ€è¦å®‰è£…çš„ä¾èµ–
const dependencies = ["vue", "vuex", "vue-router"];

// æ‰§è¡Œå®‰è£…
const child = spawn("npm", ["install", "-D"].concat(dependencies), {
  stdio: "inherit",
});

// ç›‘å¬æ‰§è¡Œç»“æœ
child.on("close", (code) => {
  // æ‰§è¡Œå¤±è´¥
  if (code !== 0) {
    console.log(chalk.red("å®‰è£…è¿‡ç¨‹å‡ºç°é”™è¯¯ï¼"));
    process.exit(1);
  }
  // æ‰§è¡ŒæˆåŠŸ
  else {
    console.log(chalk.cyan("å®‰è£…æˆåŠŸï¼"));
  }
});
```

åœ¨å‘½ä»¤è¡Œä¸­æ‰§è¡Œ`command-cli create demo`ï¼ŒæŸ¥çœ‹æ‰§è¡Œç»“æœ

![](images/2023-07-11-10-25-07.png)

## å››ã€æ­å»º whty-cli è„šæ‰‹æ¶

æˆ‘ä»¬å·²ç»å¯¹è„šæ‰‹æ¶çš„åŸºæœ¬é›å½¢å’Œå¸¸ç”¨çš„å·¥å…·åº“éƒ½æœ‰æ‰€äº†è§£äº†ï¼Œç°åœ¨æˆ‘ä»¬å°±æ¥æ­å»ºè‡ªå·±çš„è„šæ‰‹æ¶å§ã€‚<br />**éœ€è¦å®ç°çš„åŸºæœ¬åŠŸèƒ½**ï¼š

1. é€šè¿‡å‘½ä»¤è¡Œå¯åŠ¨é¡¹ç›®
2. è¯¢é—®ç”¨æˆ·éœ€è¦é€‰æ‹©ä¸‹è½½çš„æ¨¡ç‰ˆ
3. è¿œç¨‹æ‹‰å–æ¨¡ç‰ˆæ–‡ä»¶

**æ­å»ºæ­¥éª¤**ï¼š

1. åˆ›å»ºé¡¹ç›®
2. åˆ›å»ºè„šæ‰‹æ¶å¯åŠ¨å‘½ä»¤ï¼ˆä½¿ç”¨ commanderï¼‰
3. è¯¢é—®ç”¨æˆ·é—®é¢˜è·å–æ‰€éœ€ä¿¡æ¯ï¼ˆä½¿ç”¨ inquirerï¼‰
4. ä¸‹è½½è¿œç¨‹æ¨¡ç‰ˆï¼ˆä½¿ç”¨ download-git-repoï¼‰
5. å‘å¸ƒé¡¹ç›®

### 1.åˆ›å»ºé¡¹ç›®

å‚ç…§å‰é¢ç« èŠ‚çš„ä¾‹å­ï¼Œå…ˆåˆ›å»ºä¸€ä¸ªç®€å•çš„ Node-Cli ç»“æ„

```json
whty-cli
â”œâ”€ bin
â”‚  â””â”€ init.js
â””â”€ package.json
```

é…ç½®è„šæ‰‹æ¶å¯åŠ¨æ–‡ä»¶

```json
{
  "name": "whty-cli",
  "version": "1.0.0",
  "description": "ä¸€ä¸ªå‰ç«¯è„šæ‰‹æ¶",
  "main": "index.js",
  "bin": {
    "whty": "./bin/init.js"
  },
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "author": {
    "name": "sunjianfeng",
    "email": "sunjianfeng@whty.com.cn"
  },
  "license": "ISC"
}
```

ç®€å•ç¼–è¾‘ä¸‹ init.js

```js
#! /usr/bin/env node

console.log("whty-cli working~~~");
```

`npm link`é“¾æ¥åˆ°å…¨å±€<br />

![](images/2023-07-11-10-25-33.png)

å®Œæˆä¹‹åï¼Œæµ‹è¯•ä¸€ä¸‹<br />

![](images/2023-07-11-10-25-47.png)

å¯ä»¥çœ‹åˆ°æ§åˆ¶å°å·²ç»æ‰“å°å‡ºäº†æˆ‘ä»¬æƒ³è¦çš„å†…å®¹ã€‚

### 2.åˆ›å»ºè„šæ‰‹æ¶å¯åŠ¨å‘½ä»¤

å…ˆåˆ†æä¸‹æˆ‘ä»¬è¦æ€ä¹ˆåšï¼š

1. è¦å€ŸåŠ© commander ä¾èµ–å»å®ç°
2. å‚ç…§ vue-cli å¸¸ç”¨çš„å‘½ä»¤æœ‰ createã€config ç­‰ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ vue ui è¿›è¡Œå¯è§†åŒ–åˆ›å»º
3. å¦‚æœåˆ›å»ºçš„å†…å®¹å­˜åœ¨ï¼Œéœ€è¦æç¤ºæ˜¯å¦è¦†ç›–

#### 2.1 å®‰è£…ä¾èµ–

```js
npm install commander
```

#### 2.2 åˆ›å»ºå‘½ä»¤

ç¼–è¾‘ init.js

```js
#! /usr/bin/env node

const { program } = require("commander");
const pkg = require("../package.json");

program
  .command("create <app-name>")
  .description("åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®")
  // -f or --force ä¸ºå¼ºåˆ¶åˆ›å»ºï¼Œå¦‚æœåˆ›å»ºçš„ç›®å½•å­˜åœ¨åˆ™ç›´æ¥è¦†ç›–
  .option("-f --force", "è¦†ç›–å½“å‰ç›®å½•æˆ–è€…é€€å‡ºç¨‹åº")
  .action((name, options) => {
    console.log("name:", name, "options:", options);
  });

program.version(`v${pkg.version}`).usage("<command> [option]");

program.parse(process.argv);
```

åœ¨å‘½ä»¤è¡Œæ‰§è¡Œ`whty`ï¼ŒæŸ¥çœ‹å‘½ä»¤æ˜¯å¦åˆ›å»ºæˆåŠŸ

![](images/2023-07-11-10-26-06.png)

å¯ä»¥çœ‹åˆ° Commands ä¸‹é¢å·²ç»æœ‰äº†`create [options] <app-name>`ï¼Œæ¥ç€æ‰§è¡Œä¸€ä¸‹è¿™ä¸ªå‘½ä»¤<br />

![](images/2023-07-11-10-26-20.png)

å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å·²ç»æˆåŠŸæ‹¿åˆ°å‘½ä»¤è¡Œè¾“å…¥çš„ä¿¡æ¯

#### 2.3 æ‰§è¡Œå‘½ä»¤

åˆ›å»º`lib`æ–‡ä»¶å¤¹å¹¶åœ¨æ–‡ä»¶å¤¹ä¸‹åˆ›å»º`create.js`

```js
module.exports = async function (name, options) {
  console.log(">>>create.js", name, options);
};
```

åœ¨ init.js ä¸­ä½¿ç”¨ create.js

```js
...

program
  .command('create <app-name>')
  .description('åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®')
  // -f or --force ä¸ºå¼ºåˆ¶åˆ›å»ºï¼Œå¦‚æœåˆ›å»ºçš„ç›®å½•å­˜åœ¨åˆ™ç›´æ¥è¦†ç›–
  .option('-f --force', 'è¦†ç›–å½“å‰ç›®å½•æˆ–è€…é€€å‡ºç¨‹åº')
  .action((name, options) => {
    require('../lib/create')(name, options)
  })

...
```

æ‰§è¡Œä¸€ä¸‹`whty create demo`ï¼Œæ­¤æ—¶åœ¨ create.js æ­£å¸¸æ‰“å°äº†æˆ‘ä»¬è¾“å…¥çš„ä¿¡æ¯

![](images/2023-07-11-10-26-41.png)

åœ¨åˆ›å»ºç›®å½•çš„æ—¶å€™ï¼Œéœ€è¦æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼šç›®å½•æ˜¯å¦å·²å­˜åœ¨ï¼Ÿ

1. å·²å­˜åœ¨
   1. å½“`{ force: true }`æ—¶ï¼Œç›´æ¥ç§»é™¤åŸæ¥çš„ç›®å½•ï¼Œåˆ›å»ºç›®å½•
   2. å½“`{ force: false }`æ—¶ï¼Œè¯¢é—®ç”¨æˆ·æ˜¯å¦è¦†ç›–
2. ä¸å­˜åœ¨ï¼Œç›´æ¥åˆ›å»ºç›®å½•

æˆ‘ä»¬åœ¨è¿™é‡Œç”¨åˆ°äº† fs çš„æ‰©å±•å·¥å…·[fs-extra](https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Ffs-extra)ï¼Œæˆ‘ä»¬å…ˆå®‰è£…ä¸€ä¸‹

```js
npm install fs-extra
```

å®Œå–„ä¸€ä¸‹ create.js å†…éƒ¨çš„é€»è¾‘

```js
const path = require("path");
const fs = require("fs-extra");

module.exports = async function (name, options) {
  // å½“å‰å‘½ä»¤è¡Œé€‰æ‹©çš„ç›®å½•
  const cwd = process.cwd();
  // éœ€è¦åˆ›å»ºçš„ç›®å½•åœ°å€
  const targetDir = path.join(cwd, name);
  // ç›®å½•æ˜¯å¦å·²å­˜åœ¨
  if (fs.existsSync(targetDir)) {
    // æ˜¯å¦åˆ›å»ºåˆ›å»º
    if (options.force) {
      await fs.remove(targetDir);
    } else {
      // TODO: è¯¢é—®ç”¨æˆ·æ˜¯å¦ç¡®å®šè¦è¦†ç›–
    }
  }
};
```

è¯¢é—®éƒ¨åˆ†çš„é€»è¾‘ï¼Œæˆ‘ä»¬åœ¨ä¸‹ä¸€ç« èŠ‚ç»§ç»­å®Œå–„ã€‚

#### 2.4 åˆ›å»ºæ›´å¤šå‘½ä»¤

å¦‚æœæƒ³æ·»åŠ å…¶ä»–å‘½ä»¤ä¹Ÿæ˜¯ç›¸åŒçš„å¤„ç†æ–¹å¼ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š

```js
...

// é…ç½®configå‘½ä»¤
program
  .command('config [value]')
  .description('æ£€æŸ¥å¹¶ä¿®æ”¹é…ç½®')
  .option('-g, --get <path>', 'ä»é€‰é¡¹ä¸­è·å–å€¼')
  .option('-s, --set <path> <value>')
  .option('-d, --delete <path>', 'ä»é…ç½®ä¸­åˆ é™¤é€‰é¡¹')
  .action((value, options) => {
    console.log(value, options)
  })

// é…ç½®uiå‘½ä»¤
program
  .command('ui')
  .description('å¼€å§‹å¹¶æ·»åŠ open whty-cli ui')
  .option('-p, --port <port>', 'ç”¨äºUIæœåŠ¡çš„ç«¯å£')
  .action((option) => {
    console.log(option)
  })

...
```

#### 2.5 å®Œå–„å¸®åŠ©ä¿¡æ¯

æˆ‘ä»¬å¯ä»¥çœ‹ä¸‹ vue-cli æ‰§è¡Œ`--help`æ‰“å°çš„æ¶ˆæ¯

![](images/2023-07-11-10-27-04.png)

å¯¹æ¯”æˆ‘ä»¬æ‰§è¡Œ`whty --help`æ‰“å°çš„ç»“æœï¼Œç»“å°¾å¤„å¤šäº†ä¸€æ¡è¯´æ˜ä¿¡æ¯ï¼Œæˆ‘ä»¬è¿›è¡Œä¸‹è¡¥å……ã€‚è¿™é‡Œæ³¨éœ€è¦æ³¨æ„ï¼šè¯´æ˜ä¿¡æ¯æ—¶å¸¦æœ‰é¢œè‰²çš„ï¼Œæ‰€ä»¥è¿™é‡Œå°±è¦ç”¨åˆ°[chalk](https://www.npmjs.com/package/chalk

)æ¥å¤„ç†

```js
...

program
  .on('--help', () => {
    // æ–°å¢è¯´æ˜ä¿¡æ¯
    console.log(`\r\nRun ${chalk.cyan(`whty <command> --help`)} show details\r\n`)
  })

...
```

#### 2.6 æ‰“å°ä¸€ä¸ª Logo

å¦‚æœæˆ‘ä»¬æƒ³ç»™è„šæ‰‹æ¶é…ç½®ä¸€ä¸ª Logoï¼Œå¯ä»¥ä½¿ç”¨å·¥å…·åº“çš„[figlet](https://www.npmjs.com/package/figlet)

```js
...

program
  .on('--help', () => {
    // ä½¿ç”¨figletç»˜åˆ¶logo
    console.log('\r\n' + figlet.textSync('whty', {
      font: 'Standard',
      horizontalLayout: 'default',
      verticalLayout: 'default',
      width: 80,
      whitespace: true
    }));

    // æ–°å¢è¯´æ˜ä¿¡æ¯
    console.log(`\r\nRun ${chalk.cyan(`whty <command> --help`)} show details\r\n`)
  })

...
```

å†æ‰§è¡Œä¸‹`whty --help`ï¼Œçœ‹ä¸‹æ§åˆ¶å°è¾“å‡ºçš„å†…å®¹<br />

![](images/2023-07-11-10-27-21.png)

### 3.è¯¢é—®ç”¨æˆ·é—®é¢˜ï¼Œè·å–åˆ›å»ºæ‰€éœ€ä¿¡æ¯

æ¥ä¸‹æ¥æˆ‘ä»¬è¦åšçš„ï¼š

1. è¯¢é—®ç”¨æˆ·æ˜¯å¦è¦†ç›–å·²å­˜åœ¨çš„ç›®å½•
2. ç”¨æˆ·é€‰æ‹©æ¨¡ç‰ˆ
3. ç”¨æˆ·é€‰æ‹©äººç‰ˆæœ¬
4. è·å–ä¸‹è½½æ¨¡ç‰ˆçš„é“¾æ¥

#### 3.1 è¯¢é—®æ˜¯å¦è¦†ç›–å·²å­˜åœ¨çš„ç›®å½•

æˆ‘ä»¬å…ˆå®Œæˆ 2.3 ç« èŠ‚çš„é—ç•™é—®é¢˜ã€‚å…ˆå®‰è£…ä¸€ä¸‹

```js
npm install inquirer
```

ç„¶åè¯¢é—®ç”¨æˆ·æ˜¯å¦è¦†ç›–ç›®å½•

```js
const path = require("path");
const fs = require("fs-extra");
const inquirer = require("inquirer");

module.exports = async function (name, options) {
  // å½“å‰å‘½ä»¤è¡Œé€‰æ‹©çš„ç›®å½•
  const cwd = process.cwd();
  // éœ€è¦åˆ›å»ºçš„ç›®å½•åœ°å€
  const targetDir = path.join(cwd, name);
  // ç›®å½•æ˜¯å¦å·²å­˜åœ¨
  if (fs.existsSync(targetDir)) {
    // æ˜¯å¦åˆ›å»ºåˆ›å»º
    if (options.force) {
      await fs.remove(targetDir);
    } else {
      // è¯¢é—®ç”¨æˆ·æ˜¯å¦ç¡®å®šè¦è¦†ç›–
      let { action } = await inquirer.prompt([
        {
          name: "action",
          type: "list",
          message: `${targetDir}ç›®å½•å·²å­˜åœ¨ï¼Œè¯·é€‰æ‹©æ“ä½œï¼š`,
          choices: [
            {
              name: "è¦†ç›–",
              value: "overwrite",
            },
            {
              name: "å–æ¶ˆ",
              value: false,
            },
          ],
        },
      ]);

      if (!action) {
        return;
      } else if (action === "overwrite") {
        // ç§»é™¤å·²å­˜åœ¨çš„ç›®å½•
        console.log(`\r\nRemoving...`);
        await fs.remove(targetAir);
      }
    }
  }
};
```

æˆ‘ä»¬æµ‹è¯•ä¸€ä¸‹ï¼š

1. åœ¨å½“å‰ç›®å½•ï¼Œå³å‘½ä»¤è¡Œä¸­æ˜¾ç¤ºçš„ç›®å½•ä¸‹æ‰‹åŠ¨åˆ›å»º 2 ä¸ªç›®å½•ï¼Œä¾‹å¦‚ï¼šdemoã€demo1
2. æ‰§è¡Œ`whty create demo`ï¼Œæ•ˆæœå¦‚ä¸‹

![](images/2023-07-11-10-27-36.png)

3. æ‰§è¡Œ`whty create demo1 -f`æˆ–`whty create demo1 --force`ï¼Œå¯æœ‰çœ‹åˆ° demo1 ç›®å½•è¢«ç›´æ¥ç§»é™¤

ç›®å‰è¿™é‡Œåªåšäº†ç›®å½•çš„ç§»é™¤ï¼Œç›®å½•çš„åˆ›å»ºæˆ‘ä»¬åœ¨è·å–åˆ°æ¨¡ç‰ˆåœ°å€åï¼Œä¸‹è½½çš„æ—¶å€™ä¼šè¿›è¡Œã€‚

#### 3.2 å¦‚ä½•è·å–æ¨¡ç‰ˆä¿¡æ¯

è¿™é‡Œæˆ‘ä»¬æ‹¿ vuejs è¿œç¨‹ä»“åº“ä¸ºä¾‹ï¼ˆæˆ–è€…ä½¿ç”¨ä½ è‡ªå·±çš„è¿œç¨‹ä»“åº“çš„é¡¹ç›®æ¨¡ç‰ˆï¼‰ã€‚<br />github æä¾›äº†

- [https://api.github.com/orgs/vuejs/repos](https://api.github.com/orgs/vuejs/repos) æ¥å£è·å–æ¨¡ç‰ˆä¿¡æ¯
- [https://api.github.com/repos/vuejs/${repo}/tags](https://api.github.com/repos/vuejs/${repo}/tags) æ¥å£è·å–ç‰ˆæœ¬ä¿¡æ¯

å…ˆå®‰è£… `axios`

```js
npm install axios
```

åœ¨ lib ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª`request.js`ä¸“é—¨å¤„ç†æ¨¡ç‰ˆå’Œç‰ˆæœ¬ä¿¡æ¯çš„è·å–

```js
const axios = require("axios");

axios.interceptors.response.use((res) => {
  return res.data;
});

// è·å–æ¨¡ç‰ˆåˆ—è¡¨
async function fetchRepoList() {
  return await axios.get("https://api.github.com/orgs/vuejs/repos");
}

// è·å–ç‰ˆæœ¬ä¿¡æ¯
async function fetchTagList(repo) {
  return await axios.get(`https://api.github.com/repos/vuejs/${repo}/tags`);
}

module.exports = {
  fetchRepoList,
  fetchTagList,
};
```

#### 3.3 ç”¨æˆ·é€‰æ‹©æ¨¡ç‰ˆ

æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª`Generator.js`æ¥å¤„ç†é¡¹ç›®åˆ›å»ºé€»è¾‘

```js
class Generator {
  constructor(name, targetDir) {
    // ç›®å½•åç§°
    this.name = name;
    // åˆ›å»ºä½ç½®
    this.targetDir = targetDir;
  }

  // åˆ›å»ºæ–¹æ³•
  create() {}
}
```

åœ¨`create.js`ä¸­å¼•å…¥ Generator ç±»

```js
...
const Generator = require('./Generator')

module.exports = async function (name, options) {
  // å½“å‰å‘½ä»¤è¡Œé€‰æ‹©çš„ç›®å½•
  const cwd = process.cwd()
  // éœ€è¦åˆ›å»ºçš„ç›®å½•åœ°å€
  const targetDir = path.join(cwd, name)
  // ç›®å½•æ˜¯å¦å·²å­˜åœ¨
  if (fs.existsSync(targetDir)) {
    ...
  }

  // åˆ›å»ºé¡¹ç›®
  const generator = new Generator(name, targetDir)

  // å¼€å§‹åˆ›å»ºé¡¹ç›®
  generator.create()
}
```

æ¥ç€æ¥å®Œå–„è¯¢é—®ç”¨æˆ·é€‰æ‹©æ¨¡ç‰ˆçš„é€»è¾‘

```js
const { fetchRepoList } = require("./request");
const ora = require("ora");
const inquirer = require("inquirer");

// æ·»åŠ åŠ è½½åŠ¨ç”»
async function loading(fn, message, ...args) {
  // ä½¿ç”¨oraåˆå§‹åŒ–ï¼Œä¼ å…¥æç¤ºä¿¡æ¯message
  const spinner = ora(message);
  // å¼€å§‹åŠ¨ç”»
  spinner.start();

  try {
    // æ‰§è¡Œä¼ å…¥æ–¹æ³•fn
    const result = await fn(...args);
    // çŠ¶æ€æ”¹ä¸ºæˆåŠŸ
    spinner.succeed();
    return result;
  } catch (error) {
    // çŠ¶æ€æ”¹ä¸ºå¤±è´¥
    spinner.fail("è¯·æ±‚å¤±è´¥...");
  }
}

class Generator {
  constructor(name, targetDir) {
    // ç›®å½•åç§°
    this.name = name;
    // åˆ›å»ºä½ç½®
    this.targetDir = targetDir;
  }

  // è·å–ç”¨æˆ·é€‰æ‹©çš„æ¨¡ç‰ˆ
  async getRepo() {
    // ä»è¿œç¨‹ä»“åº“è·å–é¡¹ç›®æ¨¡ç‰ˆ
    const repoList = await loading(fetchRepoList, "æ¨¡ç‰ˆä¸‹è½½ä¸­...");
    if (!repoList) return;

    // è¿‡æ»¤éœ€è¦çš„æ¨¡ç‰ˆåç§°
    const repos = repoList.map((item) => item.name);
    // ç”¨æˆ·é€‰æ‹©ä¸‹è½½çš„æ¨¡ç‰ˆåç§°
    const { repo } = await inquirer.prompt({
      name: "repo",
      type: "list",
      choices: repos,
      message: "è¯·é€‰æ‹©é¡¹ç›®æ¨¡ç‰ˆä»¥åˆ›å»ºé¡¹ç›®",
    });

    return repo;
  }

  // åˆ›å»ºæ–¹æ³•
  async create() {
    // è·å–æ¨¡ç‰ˆåç§°
    const repo = await this.getRepo();
    console.log("ç”¨æˆ·é€‰æ‹©äº†ï¼Œrepo=" + repo);
  }
}

module.exports = Generator;
```

æµ‹è¯•ä¸€ä¸‹ï¼Œçœ‹çœ‹æ§åˆ¶å°è¾“å‡ºçš„å†…å®¹

![](images/2023-07-11-10-28-01.png)

é»˜è®¤é€‰æ‹©äº† vueï¼Œæ­¤æ—¶

![](images/2023-07-11-10-28-13.png)

æˆåŠŸæ‹¿åˆ°æˆ‘ä»¬æƒ³è¦çš„ä¿¡æ¯

#### 3.4 ç”¨æˆ·é€‰æ‹©ç‰ˆæœ¬

æ­¤è¿‡ç¨‹å’Œä¸Šä¸€ç« èŠ‚ç›¸åŒ

```js
const { fetchRepoList, fetchTagList } = require('./request')
...

// æ·»åŠ åŠ è½½åŠ¨ç”»
async function loading (fn, message, ...args) {
  ...
}

class Generator {
  constructor(name, targetDir) {
    // ç›®å½•åç§°
    this.name = name
    // åˆ›å»ºä½ç½®
    this.targetDir = targetDir
  }

  // è·å–ç”¨æˆ·é€‰æ‹©çš„æ¨¡ç‰ˆ
  async getRepo() {
    ...
  }

  // è·å–ç”¨æˆ·é€‰æ‹©çš„ç‰ˆæœ¬
  async getTag(repo) {
    // åŸºäºrepoï¼Œè¿œç¨‹æ‹‰å–å¯¹åº”çš„tagåˆ—è¡¨
    const tags = await loading(fetchTagList, 'æ¨¡ç‰ˆç‰ˆæœ¬ä¸‹è½½ä¸­...', repo)
    if (!tags) return

    // è¿‡æ»¤æˆ‘ä»¬éœ€è¦çš„tag
    const tagList = await tags.map(item => item.name)

    // ç”¨æˆ·é€‰æ‹©éœ€è¦ä¸‹è½½çš„tag
    const { tag } = await inquirer.prompt({
      name: 'tag',
      type: 'list',
      choices: tagList,
      message: 'è¯·é€‰æ‹©ç‰ˆæœ¬ä»¥åˆ›å»ºé¡¹ç›®'
    })

    return tag
  }

  // åˆ›å»ºæ–¹æ³•
  async create() {
    // è·å–æ¨¡ç‰ˆåç§°
    const repo = await this.getRepo()

    // è·å–ç‰ˆæœ¬åç§°
    const tag = await this.getTag(repo)

    console.log('ç”¨æˆ·é€‰æ‹©äº†ï¼Œrepo=' + repo + ', tag=' + tag)
  }
}

module.exports = Generator
```

æˆ‘ä»¬å†æ¥æµ‹è¯•ä¸€ä¸‹ï¼Œæ‰§è¡Œ`whty create demo`

![](images/2023-07-11-10-28-37.png)

é€‰æ‹©ç‰ˆæœ¬ä¹‹åï¼Œæ§åˆ¶å°æ‰“å°çš„ä¿¡æ¯

![](images/2023-07-11-10-28-50.png)

è‡³æ­¤ï¼Œè¯¢é—®ç”¨æˆ·ç›¸å…³å†…å®¹å°±ç»“æŸäº†ï¼Œå¯ä»¥è¿›è¡Œæ¨¡ç‰ˆä¸‹è½½

### 4.ä¸‹è½½è¿œç¨‹æ¨¡ç‰ˆ

ä¸‹è½½è¿œç¨‹æ¨¡ç‰ˆéœ€è¦ä½¿ç”¨[download-git-repo](https://link.juejin.cn?target=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fdownload-git-repo)å·¥å…·åŒ…ï¼Œåœ¨ä½¿ç”¨çš„æ—¶å€™éœ€è¦æ³¨æ„ï¼šå®ƒä¸æ”¯æŒ promiseï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨ util æ¨¡å—ä¸­çš„[promisify](https://link.juejin.cn/?target=http%3A%2F%2Fnodejs.cn%2Fapi%2Futil.html%23util_util_promisify_original)æ–¹æ³•è¿›è¡Œ promise åŒ–

#### 4.1 å®‰è£…ä¾èµ–ä¸ promise åŒ–

```js
npm install download-git-repo
```

è¿›è¡Œ promise åŒ–å¤„ç†

```js
...

const util = require('util')
const downloadGitRepo = require('download-git-repo')

class Generator {
  constructor(name, targetDir) {
    // ç›®å½•åç§°
    this.name = name
    // åˆ›å»ºä½ç½®
    this.targetDir = targetDir
    // è¿›è¡ŒpromiseåŒ–å¤„ç†ã€‚å®ƒè¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œè¿™ä¸ªæ–°å‡½æ•°ä¸åŸæ¥çš„ downloadGitRepo å‡½æ•°åŠŸèƒ½ç›¸åŒï¼Œä½†è¿”å›çš„æ˜¯ä¸€ä¸ª Promise å¯¹è±¡
    this.downloadGitRepo = util.promisify(downloadGitRepo)
  }

  ...
}
```

#### 4.2 ä¸‹è½½åŠŸèƒ½

ä»¥ä¸‹å°±æ˜¯ä¸‹è½½éƒ¨åˆ†çš„é€»è¾‘

```js
...
const util = require('util')
const downloadGitRepo = require('download-git-repo')
const path = require('path')
const chalk = require('chalk')

...

class Generator {
  constructor(name, targetDir) {
    ...

    // å¯¹ download-git-repo è¿›è¡ŒpromiseåŒ–å¤„ç†
    this.downloadGitRepo = util.promisify(downloadGitRepo)
  }

  ...

  // ä¸‹è½½è¿œç¨‹æ¨¡ç‰ˆ
  async download(repo, tag) {
    // æ‹¼æ¥ä¸‹è½½åœ°å€
    const requestUrl = `vuejs/${repo}${tag?'#'+tag:''}`
    // è°ƒç”¨ä¸‹è½½æ–¹æ³•
    await loading(
      this.downloadGitRepo, // ä¸‹è½½æ–¹æ³•
      'æ¨¡ç‰ˆä¸‹è½½ä¸­...', // åŠ è½½æç¤ºä¿¡æ¯
      requestUrl, // ä¸‹è½½åœ°å€
      path.resolve(process.cwd(), this.targetDir // é¡¹ç›®åˆ›å»ºä½ç½®
    ))
  }

  // åˆ›å»ºæ–¹æ³•
  async create() {
    ...

    // ä¸‹è½½æ¨¡ç‰ˆåˆ°ç›®å½•
    await this.download(repo, tag)

    // æ¨¡ç‰ˆåˆ›å»ºæç¤º
    console.log(`\r\nåˆå§‹åŒ– ${chalk.cyan(this.name)} å®Œæˆï¼Œæ„Ÿè°¢ä¸€è·¯å¥‹æ–—çš„ä½ ï¼`)
    console.log(`\r\n  cd ${chalk.cyan(this.name)}`)
    console.log('  npm run dev\r\n')
  }
}

module.exports = Generator
```

è‡³æ­¤ï¼Œä¸€ä¸ªç®€å•çš„è„šæ‰‹æ¶å°±å®Œæˆäº†ã€‚

æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ï¼Œæ‰§è¡Œ`whty create demo`

![](images/2023-07-11-10-29-17.png)

è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ¨¡ç‰ˆå·²ç»åˆ›å»ºå¥½äº†

![](images/2023-07-11-10-29-27.png)

### 5.å‘å¸ƒé¡¹ç›®

ä»¥ä¸Šæˆ‘ä»¬éƒ½æ˜¯åœ¨æœ¬åœ°è¿›è¡Œçš„æµ‹è¯•ï¼Œåœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œå¯èƒ½éœ€è¦å‘å¸ƒåˆ° npm ä»“åº“ï¼Œé€šè¿‡ npm å…¨å±€å®‰è£…ä¹‹åï¼Œç›´æ¥åˆ°ç›®æ ‡ç›®å½•ä¸‹é¢å»åˆ›å»ºé¡¹ç›®ã€‚é‚£ä¹ˆå¦‚ä½•å‘å¸ƒå‘¢ï¼Ÿ

1. åœ¨ git ä¸Šåˆ›å»ºå¥½ä»“åº“
2. å®Œå–„ package.json é…ç½®

```json
{
  "name": "whty-cli",
  "version": "1.0.0",
  "description": "ä¸€ä¸ªå‰ç«¯è„šæ‰‹æ¶",
  "main": "index.js",
  "bin": {
    "ty": "./bin/init.js"
  },
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "author": {
    "name": "sunjianfeng",
    "email": "sunjianfeng@whty.com.cn"
  },
  "keywords": ["ty", "cli"],
  "license": "ISC",
  "dependencies": {
    "axios": "^1.2.1",
    "chalk": "^4.1.2",
    "commander": "^9.4.1",
    "download-git-repo": "^3.0.2",
    "figlet": "^1.5.2",
    "fs-extra": "^11.1.0",
    "inquirer": "^8.2.5",
    "ora": "^5.4.1"
  }
}
```

3. ä½¿ç”¨ `npm publish`å°†é¡¹ç›®å‘å¸ƒè‡³ npmï¼Œæ›´æ–°çš„æ—¶å€™ï¼Œæ³¨æ„ä¿®æ”¹ç‰ˆæœ¬å·ã€‚

![](images/2023-07-11-10-29-43.png)

è‡³æ­¤ï¼Œæˆ‘ä»¬çš„è„šæ‰‹æ¶å°±å‘å¸ƒæˆåŠŸäº†ã€‚

æ³¨æ„ï¼šnpm ä¸Šé¡¹ç›®åŒ…çš„åç§°ä¸æˆ‘ä»¬ä¸€å¼€å§‹å®šä¹‰çš„ä¸ä¸€è‡´ï¼Œè¿™æ˜¯ç”±äºä¹‹å‰çš„åŒ…åç§°å·²ç»è¢«åˆ«äººä½¿ç”¨äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠ package.json ä¸­çš„ name ä¿®æ”¹ä¸€ä¸‹å³å¯ã€‚

æˆ‘ä»¬çš„é¡¹ç›®å‘å¸ƒæˆåŠŸä¹‹åï¼Œå°±å¯ä»¥é€šè¿‡ npm æˆ– yarn å…¨å±€å®‰è£…ä½¿ç”¨äº†ã€‚

![](images/2023-07-11-10-30-21.png)

![](images/2023-07-11-10-30-30.png)

## äº”ã€æ­å»ºè‡ªå·±çš„ create-vue3-template æ¨¡æ¿è„šæ‰‹æ¶ dt-vue3-cli

- é¡¹ç›®æ¨¡æ¿åœ°å€ä¸ºï¼šhttps://github.com/Daotin/create-vue3-template
- è„šæ‰‹æ¶åœ°å€ï¼šhttps://github.com/Daotin/dt-vue3-cli

åˆ›å»ºè‡ªå·±çš„é¡¹ç›®æˆåŠŸï¼ğŸ‰

![](images/2023-07-11-15-33-08.png)

![](images/2023-07-11-15-33-48.png)

è‡³æ­¤ï¼Œæˆ‘ä»¬çš„è„šæ‰‹æ¶å°±æ„å»ºå‘å¸ƒå®Œæ¯•äº†ï¼
