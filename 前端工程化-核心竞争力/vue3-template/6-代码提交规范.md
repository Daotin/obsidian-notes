## git commitæäº¤è§„èŒƒ
gitæäº¤è§„èŒƒï¼šå‚è€ƒï¼š[git commit æäº¤è§„èŒƒ](https://daotin.github.io/posts/2022/08/10/git-commit%E8%A7%84%E8%8C%83.html)


## Lint-stagedä»£ç æäº¤è§„èŒƒæ£€æŸ¥

Lint-staged æ˜¯ä¸€ä¸ªåœ¨ git æš‚å­˜åŒºæ–‡ä»¶ä¸Šè¿è¡Œ linters çš„å·¥å…·ï¼Œç¡®ä¿å³å°†æäº¤çš„ä»£ç ç¬¦åˆé¡¹ç›®çš„ä»£ç è§„èŒƒï¼Œé˜²æ­¢ä¸ç¬¦åˆè§„èŒƒçš„ä»£ç è¢«æäº¤åˆ°ä»“åº“ä¸­ã€‚å®ƒä¸ husky é…åˆä½¿ç”¨ï¼Œåœ¨ä»£ç æäº¤å‰è‡ªåŠ¨è¿è¡Œæ£€æŸ¥ã€‚

ä¸»è¦ç‰¹ç‚¹ï¼š

- ğŸš€ **é«˜æ•ˆ** - åªæ£€æŸ¥å¾…æäº¤çš„æ–‡ä»¶ï¼Œè€Œä¸æ˜¯æ•´ä¸ªé¡¹ç›®
- ğŸ›¡ï¸ **å®‰å…¨** - ç¡®ä¿æäº¤çš„ä»£ç ç¬¦åˆé¢„è®¾çš„ä»£ç æ ‡å‡†
- ğŸ”„ **è‡ªåŠ¨åŒ–** - é›†æˆåˆ° git å·¥ä½œæµä¸­ï¼Œæäº¤å‰è‡ªåŠ¨æ‰§è¡Œ

é¡¹ç›®é…ç½®è¯´æ˜ï¼š

åœ¨æœ¬é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ lint-staged æ¥æ‰§è¡Œä»¥ä¸‹æ£€æŸ¥ï¼š

- å¯¹äº `.vue`ã€`.ts`ã€`.tsx`ã€`.js`ã€`.jsx` å’Œ `.json` æ–‡ä»¶ï¼šè¿è¡Œ ESLint æ£€æŸ¥
- å¯¹äº `.css`ã€`.less` å’Œ `.vue` æ–‡ä»¶ï¼šè¿è¡Œ Stylelint æ£€æŸ¥

#### Lint-stagedå®‰è£…æ­¥éª¤

1. å®‰è£…lint-stagedåŒ…
```
pnpm add lint-staged -D
```


2. åœ¨package.jsonä¸­é…ç½®lint-staged
```json
{
	"scripts": {
		"lint-staged": "lint-staged"
	},
	// å¦‚æœä½ å¸Œæœ› lint-staged è‡ªåŠ¨ä¿®å¤å¯ä¿®å¤çš„é—®é¢˜ï¼Œå¯ä»¥åœ¨å‘½ä»¤åæ·»åŠ  `--fix` å‚æ•°
	// æ¯”å¦‚ï¼š"stylelint --cache --fix"
	// `--quiet`Â é€‰é¡¹çš„ä¸»è¦åŠŸèƒ½æ˜¯è¿‡æ»¤æ‰æ‰€æœ‰è§„åˆ™æ£€æŸ¥äº§ç”Ÿçš„è­¦å‘Šä¿¡æ¯ï¼Œåªæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
	"lint-staged": {
		"*.{vue,ts,tsx,js,jsx,json}": ["eslint --cache --max-warnings 0"],
		"*.{css,less,vue}": ["stylelint --cache"]
	}
}
```

3. ä¿®æ”¹huskyçš„pre-commité’©å­æ¥è¿è¡Œlint-staged
```bash
#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

npx lint-staged
```

ç°åœ¨ï¼Œåœ¨æ¯æ¬¡æäº¤ä»£ç å‰ï¼Œgitä¼šè‡ªåŠ¨è¿è¡Œlint-stagedï¼Œå®ƒä¼šæ ¹æ®æˆ‘ä»¬åœ¨package.jsonä¸­çš„é…ç½®ï¼Œå¯¹æš‚å­˜çš„æ–‡ä»¶è¿›è¡Œlintingæ£€æŸ¥ã€‚

### å·¥ä½œæµç¨‹

å½“ä½ æ‰§è¡Œ `git commit` å‘½ä»¤æ—¶ï¼Œå°†ä¼šè‡ªåŠ¨è§¦å‘ä»¥ä¸‹æµç¨‹ï¼š

1. Git æ‰§è¡Œ pre-commit é’©å­
2. Husky æ‹¦æˆªè¯¥é’©å­å¹¶è¿è¡Œé…ç½®çš„å‘½ä»¤ (`npx lint-staged`)
3. Lint-staged è¯†åˆ«æš‚å­˜åŒºä¸­çš„æ–‡ä»¶ï¼Œå¹¶æ ¹æ®æ–‡ä»¶ç±»å‹è¿è¡Œç›¸åº”çš„æ£€æŸ¥å·¥å…·
4. å¦‚æœæ£€æŸ¥é€šè¿‡ï¼Œcommit ç»§ç»­å®Œæˆ
5. å¦‚æœæ£€æŸ¥å¤±è´¥ï¼Œcommit è¢«é˜»æ­¢ï¼Œç»ˆç«¯æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯

### å¸¸ç”¨å‘½ä»¤

#### æ‰‹åŠ¨è¿è¡Œ lint-staged

å¦‚æœä½ æƒ³åœ¨æäº¤å‰æ‰‹åŠ¨è¿è¡Œ lint-staged æ£€æŸ¥ï¼š

```bash
pnpm lint-staged
```

#### ç»•è¿‡æ£€æŸ¥ï¼ˆä¸æ¨èï¼‰

åœ¨ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œå¦‚æœéœ€è¦ç»•è¿‡ lint-staged æ£€æŸ¥ï¼ˆ**ä¸æ¨è**ï¼‰ï¼š

```bash
git commit --no-verify -m "ä½ çš„æäº¤ä¿¡æ¯"
```

### ä¸ CommitLint çš„é›†æˆ

æœ¬é¡¹ç›®å·²é…ç½® CommitLint æ¥æ£€æŸ¥æäº¤ä¿¡æ¯çš„æ ¼å¼ã€‚è¿™ä¸ lint-staged æ˜¯ç‹¬ç«‹ä½†äº’è¡¥çš„åŠŸèƒ½ï¼š

- **lint-staged** æ£€æŸ¥ä»£ç è´¨é‡
- **CommitLint** æ£€æŸ¥æäº¤ä¿¡æ¯æ ¼å¼

æ•´ä¸ªæäº¤æµç¨‹ï¼š

1. Git pre-commit é’©å­è§¦å‘ lint-staged æ£€æŸ¥ä»£ç 
2. å¦‚æœä»£ç æ£€æŸ¥é€šè¿‡ï¼ŒGit ç»§ç»­æ‰§è¡Œ commit-msg é’©å­
3. commit-msg é’©å­è§¦å‘ CommitLint æ£€æŸ¥æäº¤ä¿¡æ¯
4. åªæœ‰å½“ä¸¤è€…éƒ½é€šè¿‡ï¼Œæäº¤æ‰ä¼šæˆåŠŸå®Œæˆ

